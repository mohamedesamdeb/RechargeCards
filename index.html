<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--glass:rgba(255,255,255,0.03);--muted:#94a3b8}
    *{box-sizing:border-box;font-family:Inter, system-ui, Arial}
    body{margin:0;background:linear-gradient(180deg,#071029 0%,#061426 100%);color:#e6eef6;display:flex;min-height:100vh}
    .sidebar{width:220px;background:var(--card);padding:20px;display:flex;flex-direction:column;gap:10px}
    .sidebar h2{font-size:18px;margin:0 0 10px 0;color:var(--accent)}
    .sidebar a{color:#fff;text-decoration:none;padding:10px;border-radius:8px;transition:0.2s}
    .sidebar a:hover{background:var(--accent);color:#012}
    .container{flex:1;padding:18px;max-width:100%}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    .card-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-bottom:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .card h3{margin:0 0 8px 0;font-size:14px}
    .big{font-weight:700;font-size:28px}
    .muted{color:var(--muted);font-size:13px}
    .regions-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .region-card{background:var(--glass);padding:12px;border-radius:10px}
    .actions{display:flex;gap:8px}
    input[type="number"],input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#012;cursor:pointer}
    .small{font-size:13px}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .loader{width:18px;height:18px;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:768px){body{flex-direction:column}.sidebar{width:100%;flex-direction:row;flex-wrap:wrap;justify-content:center}}

    table {
  border-collapse: collapse;
  width: 100%;
}

table th, table td {
  border: 1px solid rgba(255, 255, 255, 0.1); /* Ø®Ø· Ø®ÙÙŠÙ Ø´ÙØ§Ù */
  padding: 8px;
  text-align: center;
}

table th {
  background-color: rgba(255, 255, 255, 0.05); /* Ù†ÙØ³ Ø±ÙˆØ­ Ø§Ù„ØªØµÙ…ÙŠÙ… */
  font-weight: bold;
}

table tr:hover {
  background-color: rgba(255, 255, 255, 0.05); /* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
}

#filterRegion {
  background: white;
  color: black;
}

#filterRegion option {
  background: white;
  color: black;
}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
    <a href="#">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#">Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†</a>
    <a href="#">ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†</a>
    <a href="#">Ù…ÙˆØ§Ù‚Ø¹ Ù‡Ø§ØªØªØ´Ø­Ù†</a>
    <a href="#">Ù…ÙˆØ§Ù‚Ø¹ ØªÙ… Ø´Ø­Ù†Ù‡Ø§</a>
    <a href="#">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
  </div>
  <div class="container">
    <header>
      <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†</h1>
      <div class="controls">
        <label class="small">Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø±Øª (Ø¬Ù†ÙŠÙ‡): <input id="cardPrice" type="number" min="0" step="1" value="30" style="width:90px"></label>
        <button id="savePrice">Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø±</button>
        <button id="refresh">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
        <div id="spinner" style="display:none" class="loader" title="Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„"></div>
      </div>
    </header>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<section id="home-page">
  
  <!-- ÙƒØ±ÙˆØª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <section id="stats-cards" class="card-row">
    <div class="card">
      <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ (ÙƒÙ„Ù‡Ø§)</h3>
      <div id="totalSites" class="big">0</div>
      <div class="muted">Ø¹Ø¯Ø¯ ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª</div>
    </div>

    <div class="card">
      <h3>Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© Ù„Ù„Ø´Ø­Ù†</h3>
      <div id="waitingSites" class="big">0</div>
      <div class="muted">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ Ø¹Ù„Ø§Ù…Ø© "ØªØ­ØªØ§Ø¬ Ø´Ø­Ù†"</div>
    </div>

    <div class="card">
      <h3>Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø´Ø­ÙˆÙ†Ø©</h3>
      <div id="doneSites" class="big">0</div>
      <div class="muted">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù„ÙŠ ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙƒÙ€ "ØªÙ… Ø§Ù„Ø´Ø­Ù†"</div>
    </div>

    <div class="card">
      <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø¬Ù†ÙŠÙ‡)</h3>
      <div id="profit" class="big">0</div>
      <div class="muted">Ø­Ø§ØµÙ„ Ø¶Ø±Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø´Ø­ÙˆÙ†Ø© Ã— Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø±Øª</div>
    </div>
  </section>

  <!-- ØªÙØµÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© -->
  <section id="regions-section" class="card">
    <h3>ØªÙØµÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
    <div class="regions-list" id="regionsList"></div>
  </section>

</section>

<!-- ØµÙØ­Ø© Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù† -->
<section id="insert-cards-page" style="display:none;">
  <h2 style="margin-bottom: 15px; color: var(--accent);">Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†</h2>
  
  <div style="background: var(--card); padding: 20px; border-radius: 12px; max-width: 500px;">
<form id="cardForm" method="POST" action="https://script.google.com/macros/s/AKfycbwz4k7Lq9i-ovP5IQGoPMArvpNl5Ks0qTbDOoFyBwX3N8VxrQv-9nIHSpOgaWE3xyaqdA/exec">
      <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
      <div style="display: flex; margin-bottom: 10px;">
        <span style="background: var(--glass); padding: 8px 12px; border-radius: 8px 0 0 8px; border: 1px solid rgba(255,255,255,0.06);">CAI</span>
        <input name="siteNumber" type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹" required
               style="flex:1; border-radius: 0 8px 8px 0; border: 1px solid rgba(255,255,255,0.06); background: transparent; color: inherit;">
      </div>

      <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
      <input name="region" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©" required style="width:100%; margin-bottom:10px;">

      <label>Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆÙ†Ø± / Ø§Ù„ØºÙÙŠØ±</label>
      <input name="ownerNumber" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆÙ†Ø± Ø£Ùˆ Ø§Ù„ØºÙÙŠØ±" required style="width:100%; margin-bottom:10px;">

      <label>Ø±Ù‚Ù… Ø§Ù„Ù€ Access</label>
      <input name="accessNumber" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø§ÙƒØ³ÙŠØ³" required style="width:100%; margin-bottom:10px;">

      <label>Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</label>
      <input name="electricCompany" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡" required style="width:100%; margin-bottom:10px;">

      <label>Ù„ÙˆÙƒÙŠØ´Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
      <input name="location" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù†" required style="width:100%; margin-bottom:10px;">

      <button type="submit" style="width: 100%; padding: 10px; background: var(--accent); color: #012; border: none; border-radius: 8px; cursor: pointer;">
        Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      </button>
    </form>
  </div>
</section>

<!-- ØµÙØ­Ø© ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù† -->
<section id="cards-page" style="display:none;">
  <h2 style="margin-bottom: 15px; color: var(--accent);">ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†</h2>

  <div style="margin-bottom: 10px; display: flex; gap: 10px; align-items: center;">
    <input type="text" id="searchSite" placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹"
      style="padding: 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); background: transparent; color: inherit;">
    <select id="filterRegion"
      style="padding: 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); background: transparent; color: inherit;">
      <option value="">ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
    </select>
    <button id="clearAll">Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</button>
  </div>

  <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
  <div style="
    width: 100%;
    overflow-x: auto;
    overflow-y: auto;
    max-height: 400px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 8px;
  ">
    <table style="width: 100%; min-width: 800px; border-collapse: collapse; text-align: center;">
      <thead>
        <tr style="background: rgba(255,255,255,0.05);">
          <th>Ø§Ù„Ù…Ø³Ù„Ø³Ù„</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
          <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆÙ†Ø± / Ø§Ù„ØºÙÙŠØ±</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ø§ÙƒØ³ÙŠØ³</th>
          <th>Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</th>
          <th>Ù„ÙˆÙƒÙŠØ´Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
          <th>ØªØ­ØªØ§Ø¬ Ø´Ø­Ù†</th>
        </tr>
      </thead>
      <tbody id="cardsTableBody"></tbody>
    </table>
  </div>
</section>

    <footer>
      <div>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØªÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Web API ÙŠÙØ±Ø¬Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets ÙƒÙ€ JSON.</div>
    </footer>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwz4k7Lq9i-ovP5IQGoPMArvpNl5Ks0qTbDOoFyBwX3N8VxrQv-9nIHSpOgaWE3xyaqdA/exec';
    const priceInput = document.getElementById('cardPrice');
    const saveBtn = document.getElementById('savePrice');
    const refreshBtn = document.getElementById('refresh');
    const spinner = document.getElementById('spinner');

    function showLoading(show){spinner.style.display = show ? 'inline-block' : 'none'}
    const saved = localStorage.getItem('cardPrice');
    if(saved) priceInput.value = saved;

    saveBtn.addEventListener('click', ()=>{
      localStorage.setItem('cardPrice', priceInput.value);
      toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø±');
      computeUI(lastData);
    });
    refreshBtn.addEventListener('click', ()=> fetchAndRender());

    function toast(msg){
      const el = document.createElement('div');
      el.textContent = msg; el.style.cssText = 'position:fixed;left:12px;bottom:12px;background:#0b1220;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 20px rgba(2,6,23,0.6)';
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),1800);
    }

    let lastData = [];
    let sitesToCharge = JSON.parse(localStorage.getItem('sitesToCharge') || '[]');

function renderCardsTable(data) {
  const tbody = document.getElementById('cardsTableBody');
  tbody.innerHTML = '';

  // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±
  const search = document.getElementById('searchSite').value.trim();
  const region = document.getElementById('filterRegion').value;
let filtered = lastData;
  if (search) filtered = filtered.filter(d => d.siteNumber && d.siteNumber.toString().includes(search));
  if (region) filtered = filtered.filter(d => d.region === region);

  filtered.forEach((row, i) => {
    const isChecked = sitesToCharge.some(s => s.siteNumber === row.siteNumber);

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${row.siteNumber || ''}</td>
      <td>${row.region || ''}</td>
      <td>${row.ownerNumber || ''}</td>
      <td>${row.accessNumber || ''}</td>
      <td>${row.electricCompany || ''}</td>
      <td>
  ${row.location 
    ? `<a href="${row.location}" target="_blank" 
         style="
           display:inline-block;
           background:linear-gradient(135deg, #06b6d4, #3b82f6);
           color:white;
           padding:6px 12px;
           border-radius:12px;
           font-size:13px;
           font-weight:bold;
           text-decoration:none;
           box-shadow:0 2px 6px rgba(0,0,0,0.15);
           transition:all 0.3s ease;
         "
         onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 10px rgba(0,0,0,0.25)'"
         onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.15)'"
       >
         ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹
       </a>` 
    : ''}
</td>
      <td>
        <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleCharge(${i}, '${row.siteNumber}')">
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function toggleCharge(index, siteNumber) {
  const checkbox = document.querySelectorAll('#cardsTableBody input[type="checkbox"]')[index];

  if (!checkbox.checked) {
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØµØ­ØŸ")) {
      checkbox.checked = true;
      return;
    }
    sitesToCharge = sitesToCharge.filter(s => s.siteNumber !== siteNumber);
  } else {
    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙŠ Ø³ØªØ´Ø­Ù†
    const siteData = lastData.find(s => s.siteNumber === siteNumber);
    if (siteData) sitesToCharge.push(siteData);
  }

  localStorage.setItem('sitesToCharge', JSON.stringify(sitesToCharge));
}

// Ø²Ø±Ø§Ø± Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
document.getElementById('clearAll').addEventListener('click', () => {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ØŸ")) {
    sitesToCharge = [];
    localStorage.setItem('sitesToCharge', JSON.stringify(sitesToCharge));
    renderCardsTable(lastData);
  }
});

function populateRegionFilter(data) {
  const filterRegion = document.getElementById('filterRegion');
  const regions = [...new Set(data.map(d => d.region).filter(Boolean))];
  
  // Ù…Ø³Ø­ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
  filterRegion.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>';
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
  regions.forEach(region => {
    const opt = document.createElement('option');
    opt.value = region;
    opt.textContent = region;
    filterRegion.appendChild(opt);
  });
}

    async function fetchAndRender(){
      showLoading(true);
      try{
        const data = await loadJSONP(SCRIPT_URL + '?action=getAll', 'handleDataCallback');

        lastData = Array.isArray(data) ? data : (data.records || []);
        computeUI(lastData);
        populateRegionFilter(lastData);

      }catch(err){
        console.error(err);
        alert('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±.');
      }finally{showLoading(false)}
    }

    function computeUI(data){
      const total = data.length;
      const waiting = data.filter(d=>{
        const s = (d.status||'').toString().toLowerCase();
        return s.includes('need') || s.includes('ØªØ­ØªØ§Ø¬') || s.includes('pending') || s.includes('true') || s.includes('1') || s.includes('check');
      }).length;
      const done = data.filter(d=>{
        const s = (d.status||'').toString().toLowerCase();
        return s.includes('done') || s.includes('ØªÙ…') || s.includes('charged') || s.includes('completed');
      }).length;

      document.getElementById('totalSites').textContent = total;
      document.getElementById('waitingSites').textContent = waiting;
      document.getElementById('doneSites').textContent = done;

      const price = Number(localStorage.getItem('cardPrice') || priceInput.value || 30);
      document.getElementById('profit').textContent = (done * price).toLocaleString();

      const regions = {};
      data.forEach(d=>{
        const r = (d.region||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯').toString();
        if(!regions[r]) regions[r] = {total:0, waiting:0, done:0};
        regions[r].total++;
        const s = (d.status||'').toString().toLowerCase();
        if(s.includes('ØªÙ…') || s.includes('done') || s.includes('charged')) regions[r].done++;
        else if(s.includes('ØªØ­ØªØ§Ø¬') || s.includes('need') || s.includes('pending') || s.includes('check')) regions[r].waiting++;
      });

      const regionsList = document.getElementById('regionsList');
      regionsList.innerHTML = '';
      Object.keys(regions).sort().forEach(name=>{
        const info = regions[name];
        const el = document.createElement('div'); el.className='region-card';
        el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>${name}</strong><div class="muted">${info.total} Ù…ÙˆØ§Ù‚Ø¹</div></div>
                        <div style="margin-top:8px;font-size:18px;font-weight:700">${info.done}<span class="muted" style="font-weight:400"> ØªÙ…</span> â€¢ ${info.waiting}<span class="muted" style="font-weight:400"> ÙŠÙ†ØªØ¸Ø±</span></div>
                        <div style="margin-top:8px" class="actions"><button class="view-btn">Ø¹Ø±Ø¶</button><button class="filter-btn">ÙÙ„ØªØ±</button></div>`;
        regionsList.appendChild(el);
      });
    }

    document.getElementById('searchSite').addEventListener('input', () => {
  renderCardsTable(lastData);
});

document.getElementById('filterRegion').addEventListener('change', () => {
  renderCardsTable(lastData);
});


    fetchAndRender();

   document.querySelectorAll('.sidebar a').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const text = link.textContent.trim();

    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª
    document.querySelectorAll('#home-page, #insert-cards-page, #cards-page, #sites-to-charge, #sites-charged, #settings-page')
      .forEach(sec => sec.style.display = 'none');

    if (text === 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©') {
      document.getElementById('home-page').style.display = 'block';
    }
    else if (text === 'Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†') {
      document.getElementById('insert-cards-page').style.display = 'block';
    }
    else if (text === 'ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø­Ù†') {
      document.getElementById('cards-page').style.display = 'block';
      renderCardsTable(lastData); // â† Ù‡Ù†Ø§ Ø¨ÙŠØªØ¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    }
    else if (text === 'Ù…ÙˆØ§Ù‚Ø¹ Ù‡Ø§ØªØªØ´Ø­Ù†') {
      document.getElementById('sites-to-charge').style.display = 'block';
    }
    else if (text === 'Ù…ÙˆØ§Ù‚Ø¹ ØªÙ… Ø´Ø­Ù†Ù‡Ø§') {
      document.getElementById('sites-charged').style.display = 'block';
    }
    else if (text === 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª') {
      document.getElementById('settings-page').style.display = 'block';
    }
  });
});

document.getElementById('cardForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const formData = new FormData(this);

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbwz4k7Lq9i-ovP5IQGoPMArvpNl5Ks0qTbDOoFyBwX3N8VxrQv-9nIHSpOgaWE3xyaqdA/exec", {
      method: 'POST',
      body: formData
    });

    const data = await res.json();

    if (data.status === "success") {
      Swal.fire({
        icon: 'success',
        title: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
        text: data.message
      });
      this.reset();
    } else {
      Swal.fire({
        icon: 'error',
        title: 'Ø®Ø·Ø£',
        text: data.message
      });
    }
  } catch (err) {
    Swal.fire({
      icon: 'error',
      title: 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„',
      text: err.message
    });
  }
});

function loadJSONP(url, callbackName) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    const callbackFunctionName = callbackName;

    // Ø¥Ù†Ø´Ø§Ø¡ callback ÙÙŠ window Ø¹Ø´Ø§Ù† ØªØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡ JSONP
    window[callbackFunctionName] = (data) => {
      resolve(data);
      delete window[callbackFunctionName]; // ØªÙ†Ø¸ÙŠÙ
      script.remove();
    };

    script.src = `${url}&callback=${callbackFunctionName}`;
    script.onerror = () => {
      reject(new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ JSONP'));
      delete window[callbackFunctionName];
      script.remove();
    };

    document.body.appendChild(script);
  });
}
  </script>
</body>
</html>
